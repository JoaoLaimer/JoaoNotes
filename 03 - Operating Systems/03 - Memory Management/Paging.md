#### Paging
Paging is a technique where real and virtual addressing spaces are divided in equal sized blocks.
The blocks in the physical memory (RAM) are called frames.
The blocks in the logical memory are called pages.

This technique avoid adjusting sizes in a dynamic size memory.

When a process must be executed, its pages are loaded to a available frame. The mapping of virtual address to real is made using the page tables, where each process has its own table. The MMU is responsible for the translation
Each virtual page in the process has a entry in the table, with information about the mapping that allows the system to locate the real page.

Each virtual address is split into two parts: page number and offset inside the page.
The page number is used as an index of the page table, that possesses the base address of each frame in the physical memory.
The real address is obtained summing the frame address with the offset inside the page.

Example:
- p = page number
- d = page offset
- f = frame address

Logical memory of 16 bytes -> (16 bytes = 2^7 bits)
4 bytes pages -> (4 bytes = 2^5 bits)

7 total bits -> 5 bits for page offset -> 2 bits for page number


Physical memory of 32 bytes -> 2^8 bits
8 total bits -> 5 bits for page offset -> 3 bits for frame address

An entry o the page table has 3 bits and can reference only up to 2Â³ frames.

## Page Table 
Other than information about page location, the page table has information like:
- Valid Bit: If set, it tells us that the page is in the main memory
- Protection bit: It tells us what access is permitted in the page (read, write, execution).
- Modification bit: If set, tell us that page was written in the main memory.
- Reference bit: If set, tell us that the page was referenced in the main memory.

When a process references a virtual address, the MMU verifies through the valid bit if the page is in memory.
If the reference was made to a page that is not loaded to the main memory, than a page fault occurs. The system transfers the page from the secondary memory to the main memory.
The number of page faults generated by each process in a time interval is called pagination rate.
If pagination rate of processes are high, I/O operation in excess can compromise the system.

## Page Searching
By loading a page to memory, two strategies can be chosen: paging by demand and in advance.
#### By Demand 
Pages are transferred from the second memory  to main memory only when referenced.
It takes only demanded pages to the main memory.

#### In Advance
More pages can be loaded to the main memory when necessary. If the program is sequentially stored, we can load a set of pages.
If the program doesn't need the paging in advance, the system will have wasted time and memory.

### Both
A combined strategy can be used:
- The paging in advance technique can be employed on process creation.
- When the process is created, loading the pages lead to high number of page faults. But when executing the process the page fault rate lowers rapidly.


## Working Set
The main memory has pages of different processes.
During the execution of a process, some pages are loaded and other are swapped out.
When the system wastes too much time swapping pages, this is called thrashing.
To avoid thrashing is necessary to guess which part of the code is going to be necessary in the future - locality.

The working set of a process is the set of pages constantly referenced by the process.
The working set must: stay in the main memory to execute the process efficiently, must have a maximum limit of allowed pages.

If the working set is to big: Less page faults, Less process sharing the memory.

A way of implement a working set is to see the paging rate of each process.
If high: the limit of real pages has to be brought up to reach the working set.
If low: the system can lower the page limit.

## Paging Allocation Policies
Determines how many frames a process can have in the main memory.
#### Fixed Allocation
Each process has a max number of frames that can be used during execution.
If the frame limite is:
- Low -> High page faults rate
- High -> Less sharing, more process swapping
#### Variable Allocation
The number of frames allocated to a process during it's execution can vary.
If the process paging rate is:
- Low -> It's frames can be allocated to other processes.
- High -> Can set the max limit of frames higher to lower the paging rate.

## Page Substitution Policies
#### Local Scope
Only pages from the process that caused the page fault can be candidates to substitution.
#### Global Scope
All pages can be candidates to substitution.

There is a relation between the substitution and allocation policies.
**Fixed allocation** only allows local scope substitution.
**Variable allocation** allows both scopes:
- Local: In time intervals, the number of frames can be recalculated, but substitution are local.
- Global: The number of frames varies when process allocate frames from other processes.

The main difficulty in virtual memory managing is choosing which page will be taken out of the main memory.

## Page Substitution Algorithms
### OPT or MIN: Optimal Algorithm
Has the best fault page rate of all algorithms.
It substitutes the page that will not be reference for the longer time.
Hard to know in advance the reference string (order in which the pages are referenced).
As it produces the best result, is used in comparative studies to test algorithms efficiency.

Reference String: 
	7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2, 0, 1, 7, 0, 1
Sequence:
9 page faults

| 7   | 7   | 7   | 2   | 2   | 2   | 2   | 2   | 7   |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
|     | 0   | 0   | 0   | 0   | 4   | 0   | 0   | 0   |
|     |     | 1   | 1   | 3   | 3   | 3   | 1   | 1   |

### FIFO (First In First Out)
When a page needs to substituted, the oldest page will be chosen to exit the memory.
Easy to program.
It's reasonably to think that a page was loaded to the MP for a time, it has been sufficiently  referenced.
- But, this is not always true and this can make the performance worst.
- There's a chance that the first page laoaded will be the most referenced.

Reference String: 
	7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2, 0, 1, 7, 0, 1
Sequence:
15 page faults

| 7   | 7   | 7   | 2   | 2   | 2   | 4   | 4   | 4   | 0   | 0   | 0   | 7   | 7   | 7   |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
|     | 0   | 0   | 0   | 3   | 3   | 3   | 2   | 2   | 2   | 1   | 1   | 1   | 0   | 0   |
|     |     | 1   | 1   | 1   | 0   | 0   | 0   | 3   | 3   | 3   | 2   | 2   | 2   | 1   |

**Belady** Anomaly: the rate of page faults can be higher when the frame quantity rises.