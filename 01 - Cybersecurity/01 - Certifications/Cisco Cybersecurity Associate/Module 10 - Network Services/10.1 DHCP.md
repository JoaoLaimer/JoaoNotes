# 10.1.2 DHCP Operation
When an IPv4, DHCP-configured device boots up or connects to the network, the client broadcasts a DHCP discover (DHCPDISCOVER) message to identify any available DHCP servers on the network. A DHCP server replies with a DHCP offer (DHCPOFFER) message, which offers a lease to the client. The offer message contains the IPv4 address and subnet mask to be assigned, the IPv4 address of the DNS server, and the IPv4 address of the default gateway. The lease offer also includes the duration of the lease.

The client may receive multiple DHCPOFFER messages if there is more than one DHCP server on the local network. Therefore, it must choose between them, and sends a DHCP request (DHCPREQUEST) message that identifies the explicit server and lease offer that the client is accepting. A client may also choose to request an address that it had previously been allocated by the server.

Assuming that the IPv4 address requested by the client, or offered by the server, is still available, the server returns a DHCP acknowledgment (DHCPACK) message that acknowledges to the client that the lease has been finalized. If the offer is no longer valid, then the selected server responds with a DHCP negative acknowledgment (DHCPNAK) message. If a DHCPNAK message is returned, then the selection process must begin again with a new DHCPDISCOVER message being transmitted. After the client has the lease, it must be renewed prior to the lease expiration through another DHCPREQUEST message.

The DHCP server ensures that all IP addresses are unique (the same IP address cannot be assigned to two different network devices simultaneously). Most ISPs use DHCP to allocate addresses to their customers.

DHCPv6 has a set of messages that is similar to those for DHCPv4. The DHCPv6 messages are SOLICIT, ADVERTISE, INFORMATION REQUEST, and REPLY.
# 10.1.3 DHCP Message Format
![[dhcpheader.png]]


<li><strong>Operation (OP) Code</strong> - Specifies the general type of message. A value of 1 indicates a request message; a value of 2 is a reply message.</li>
<li><strong>Hardware Type</strong> - Identifies the type of hardware used in the network. For example, 1 is Ethernet, 15 is Frame Relay, and 20 is a serial line. These are the same codes used in ARP messages.</li>
<li><strong>Hardware Address Length</strong> - Specifies the length of the address.</li>
<li><strong>Hops</strong> - Controls the forwarding of messages. Set to 0 by a client before transmitting a request.</li>
<li><strong>Transaction Identifier</strong> - Used by the client to match the request with replies received from DHCPv4 servers.</li>
<li><strong>Seconds</strong> - Identifies the number of seconds elapsed since a client began attempting to acquire or renew a lease. Used by DHCPv4 servers to prioritize replies when multiple client requests are outstanding.</li>
<li><strong>Flags</strong> - Used by a client that does not know its IPv4 address when it sends a request. Only one of the 16 bits is used, which is the broadcast flag. A value of 1 in this field tells the DHCPv4 server or relay agent receiving the request that the reply should be sent as a broadcast.</li>
<li><strong>Client IP Address</strong> - Used by a client during lease renewal when the address of the client is valid and usable, not during the process of acquiring an address. The client puts its own IPv4 address in this field if and only if it has a valid IPv4 address while in the bound state; otherwise, it sets the field to 0.</li>
<li><strong>Your IP Address</strong> - Used by the server to assign an IPv4 address to the client.</li>
<li><strong>Server IP Address</strong> - Used by the server to identify the address of the server that the client should use for the next step in the bootstrap process, which may or may not be the server sending this reply. The sending server always includes its own IPv4 address in a special field called the Server Identifier DHCPv4 option.</li>
<li><strong>Gateway IP Address</strong> - Routes DHCPv4 messages when DHCPv4 relay agents are involved. The gateway address facilitates communications of DHCPv4 requests and replies between the client and a server that are on different subnets or networks.</li>
<li><strong>Client Hardware Address</strong> - Specifies the physical layer of the client.</li>
<li><strong>Server Name</strong> - Used by the server sending a DHCPOFFER or DHCPACK message. The server may optionally put its name in this field. This can be a simple text nickname or a DNS domain name, such as dhcpserver.netacad.net.</li>
<li><strong>Boot Filename</strong> - Optionally used by a client to request a particular type of boot file in a DHCPDISCOVER message. Used by a server in a DHCPOFFER to fully specify a boot file directory and filename.</li>
<li><strong>DHCP Options</strong> - Holds DHCP options, including several parameters required for basic DHCP operation. This field is variable in length. Both client and server may use this field.</li>

