A semaphore is a variable of type unsigned integer that can be manipulated by two default atomic operations (implemented by system calls).
- **wait()** , originally P (_prohoben_, that in dutch means "test");
- **signal()**, original V (_verhogen_, that in dutch means "increment" );

Don't guarantee mutual exclusion.

**wait** and **signal** are entry and exit protocols from the critical sections.
**wait** is executed when a process can wants to enter the critical regions. Decrements the semaphore by 1.
**signal** is executed when a process exits its critical region. Increments the semaphore by 1.

```
Wait(S)
	if (S == 0)
		blocks process;
	else
		S = S - 1;
```
```
Signal(S)
	if (process in queue)
		frees process;
	else
		S = S + 1;
```

A semaphore is associated to a shared resource indicating if it's being used.
If a semaphore > 0:
- The resource is available
- Process can use the resource and decrements the semaphore
If a semaphore == 0:
- The resource is being used.
- The process must change its state to "waiting" until the resource becomes available.

For mutual exclusion a binary semaphore is used (MUTEX);
```P
Wait (mutex);
critical region;
Signal (mutex);
```
Semaphores are also used to implement synchronization between processes.
**Producer X Consumer**:
- A Producer is a process that writes information in a shared buffer. Each item fills a position on the buffer.
- A Consumer is a process that uses the information written in the buffer. Each item consumed is freed from the buffer.
- The Producer can't write in a full buffer.
- A Consumer can't read in a empty buffer.

For this is used 3 semaphores:
- **Full** -> Counter Semaphore: shows the quantity of full positions.
- **Empty** -> Counter Semaphore: shows the quantity of empty positions.
- **Mutex** -> Binary Semaphore: shows if the buffer is being used.
If **Full=0** the buffer is empty -> Blocks Consumer
If **Empty=0** the buffer is full -> Blocks Producer

Programmers must be careful when using semaphores, wait and signal can lead to deadlock or starvation:
- Deadlock: Two or more processes are blocked waiting for an event that can only be generated by a blocked process.
- Starvation: Can occur, mainly, when a queue is associated with the semaphore if not for FCFS.
## Semaphores X Mutex
Semaphores is a tool to synchronize processes. Typically, semaphores are a variable S that is initialized to a number of resources present in the system and its value can be modified using only the wait() and signal() functions.
The functions modify the value of the semaphore in an atomic way, when a process is modifying it no other process can.

Mutual Exclusion (Mutex) is a technique used in concurrent programming  to avoid that two processes or threads can have simultaneously access to a shared resource, also known as critical section.

|                    | Semaphore                                                                                                                                                                   | Mutex                                                                                                                          |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| Concept            | Synchronization mechanism.                                                                                                                                                  | Blocking mechanism.                                                                                                            |
| Existence          | Unsigned Integer                                                                                                                                                            | Object                                                                                                                         |
| Function           | Allows that a chain of programs access a finite resource.                                                                                                                   | Allows a chain of programs access a resource not simultaneously.                                                               |
| Properties         | Its value can be altered by a process freeing or getting resources.                                                                                                         | The block object is freed only by the process that contains it.                                                                |
| Categories         | Can be either a binary or counter semaphore                                                                                                                                 | Its not categorized                                                                                                            |
| Operation          | Its value can only be modified using wait() and signal().                                                                                                                   | The mutex object can be blocked or unblocked by the process using it.                                                          |
| Resources Occupied | If all the resources are being used, the process wait the resource and execute the wait() function and blocks it self until the semaphore counter becomes greater than one. | If mutex object is blocked, the process that solicited the resource wait and is queued by the system until the block is freed. |
When to use?
- Semaphores when there are more then one instance of resources available.
- Mutexes when there is only one shared resource.
